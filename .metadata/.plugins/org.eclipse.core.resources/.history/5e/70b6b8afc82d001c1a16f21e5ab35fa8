package com.ICINBank.ICINbanking.controller;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.servlet.ModelAndView;

import com.ICINBank.ICINbanking.model.ChequeBook;
import com.ICINBank.ICINbanking.model.Customer;
import com.ICINBank.ICINbanking.service.ChequeBookService;
import com.ICINBank.ICINbanking.service.CustomerService;



@Controller
public class ChequeBookController {
	
	@Autowired
	private CustomerService customerService;
	
	@Autowired
	private ChequeBookService chequeBookService;
	
	@GetMapping(value="/requestChequeBook")
	public ModelAndView chequeRequestPage(HttpServletRequest request) {
		HttpSession session = request.getSession(false);
		ChequeBook chkBk = new ChequeBook();
		String username = (String) session.getAttribute("UserName"); 
		System.out.println("################################3 "+ username);
		Customer cust = customerService.findByUserName(username.toString());
		chkBk.setCustomer(cust);
		ModelAndView ChequeRequestMV = new ModelAndView();
		ChequeRequestMV.setViewName("chequeBkRequest");
		ChequeRequestMV.addObject("chequeBook",chkBk);
		return ChequeRequestMV;
		
	}
	
	@PostMapping(value="/requestChequeBook")
	public ModelAndView raiseChequeRequest(@ModelAttribute("chequeBook") ChequeBook chequeBook) {
		ModelAndView ChequeRequestMV = new ModelAndView();
		ChequeRequestMV.setViewName("userHome");
//		ChequeRequestMV.addObject("chequeBook",chequeBook);
		
		chequeBookService.createChequeBookRequest(chequeBook);
		return ChequeRequestMV;
		
	}

}
